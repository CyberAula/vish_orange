<div class="new_contribution_form_wrapper">

  <div class="modal fade" id="<%=form_id%>_resource_contribution" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <%= form_for Contribution.new, :html => { :multipart => true, :id => form_id, :class => "new_contribution_resource" }, :remote => false do |f| %>
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h3><%=t('workshop.activities.assignment.available_contributions.resource')%></h3>
          </div>
          <div class="modal-body">
            <% if !wa_assignment.nil?%>
              <%= f.hidden_field :wa_assignment_id, :value => wa_assignment.id %>
            <% elsif !parent.nil? %>
              <%= f.hidden_field :parent_id, :value => parent.id %>
            <% end %>
            <%= f.hidden_field :type, :value => "Resource" %>
            <p><%=t('workshop.activities.assignment.add_resource_message')%></p>
            <p><input type="text" name="url" value=""></input></p>
          </div>
          <div class="modal-footer">
            <%= f.submit t('workshop.activities.assignment.add_resource'), :class => "contribution btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <%= render partial: "common_resources/submit_contribution_modal", :locals => {:name => "contribution"} %>
  <button class="btn btn-primary btn_show_upload" data-toggle="modal" data-target="#join_contribution"><%= t('workshop.activities.assignment.available_contributions.resource') %></button>
</div>

<% 
  if !wa_assignment.nil?
    database_id = "wa_assignment_id: " + wa_assignment.id.to_s
  else
    database_id = "parent_id: " + parent.id.to_s
  end 
%>

<%= content_for :javascript do %>
  var onContributionModalSubmit = function(selectedUrl){
    $.ajax({
      url: "/contributions",
      method: "POST",
      data: {
        contribution:{
          <%= database_id %>,
          type: "Resource"
        },
        url:  selectedUrl,
        authenticity_token: "<%= form_authenticity_token %>" 
      },
      success: function(e){
          window.location.reload();
      },
      error: function(e){
          window.location.reload();
      }
    });
  };
<% end %>
