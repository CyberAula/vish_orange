<div class="new_contribution_form_wrapper">

  <div class="modal fade" id="<%=form_id%>_resource_contribution" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <%= form_for Contribution.new, :html => { :multipart => true, :id => form_id, :class => "new_contribution_resource" }, :remote => false do |f| %>
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h3><%=t('workshop.activities.assignment.available_contributions.resource')%></h3>
          </div>
          <div class="modal-body">
            <% if !wa_assignment.nil?%>
              <%= f.hidden_field :wa_assignment_id, :value => wa_assignment.id %>
            <% elsif !parent.nil? %>
              <%= f.hidden_field :parent_id, :value => parent.id %>
            <% end %>
            <%= f.hidden_field :type, :value => "Resource" %>
            <p><%=t('workshop.activities.assignment.add_resource_message')%></p>
            <p><input type="text" name="url" value=""></input></p>
          </div>
          <div class="modal-footer">
            <%= f.submit t('workshop.activities.assignment.add_resource'), :class => "contribution btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

<%=
    if current_subject != nil
      my_items = subject_resources(current_subject, {:scope => :me, :limit => 0})
    else 
      my_items = []
    end

    render partial: "common_resources/select_modal", locals:{
    name: "contribution",
    my_items: my_items,
    title1:"Selecciona uno de tus recursos",
    title2: "Elige la excursión con la que quieres participar en el workshop",
    notfound: "Lo sentimos no puede entrar a la competición porque todavía no tiene ninguna excursión",
    button_name: "Subir mi propuesta" } %>

  <button class="btn btn-primary btn_show_upload" data-toggle="modal" data-target="#join_contribution"><%= t('workshop.activities.assignment.available_contributions.resource') %></button>
  
</div>

<% if !wa_assignment.nil?
  database_id ="wa_assignment_id: " + wa_assignment.id.to_s
 else 
  database_id = "parent_id: " + parent.id.to_s
  end%>

<%= content_for :javascript do %>

    $("#button_for_contribution").attr("disabled", "disabled");
    $(".box-item a").attr('url', $(".box-item a").attr('href') );

    $(".box-item a").removeAttr('href');

    $(".box-item").click(function(){
      if(!$(this).hasClass("selected")){
        $(".box-item").removeClass("selected");
        $(this).addClass("selected");
        $( "#button_for_contribution" ).removeAttr("disabled");
      } else {
        $(this).removeClass("selected");
        $( "#button_for_contribution" ).attr("disabled", "disabled");
      }
    });

    $("#button_for_contribution").click(function(){
      var selected_items = $(".selected .container-img .img-box").attr("id");
      var url = $('.selected a').attr("url");
      $.ajax({
        url: "/contributions",
        method: "POST",
        data: { 
        contribution:{ 
        id : selected_items, <%= database_id %>, type: "Resource"} , 
        url: "<%= Vish::Application.config.full_domain %>" + url,
        authenticity_token: "<%= form_authenticity_token %>" },
        success: function(e){
            window.location.reload();
        },
        error: function(e){

        }
      });
    });


<% end %>