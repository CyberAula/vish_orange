<%content_for :title do%><%= t("site.meta_title.sign_up") %><%end%>
<%content_for :keywords do%><%= t("site.current.keywords") %><%end%>
<%content_for :description do%><%= t("site.meta_desc.sign_up")%><%end%>
<%content_for :alternate_urls do%><%=raw alternate_urls(request.original_url, nil)%><%end%>

<section id="registration">
  <section class="registration">
    <h4><%= t('mooc.log_in').capitalize %></h4>
    <p><%= t('mooc.go_to_login') %></p>
    <%= link_to t('mooc.sign_in'), 'https://educainternet.es/cas/cas/login?service=http%3A%2F%2Feducainternet.es%2Fusers%2Fedit%3Fmooc%3Dtrue', :class => "btn btn-primary btn-logmooc pull-right "%>
    <div class="clear"></div>
  </section>
  <section class="registration">
    <h4><%= t('mooc.sign_up').capitalize %></h4>
    <p><%= t('mooc.sign_up2') %><br><span class="required_fields"><%= t('mooc.sign_up3') %></span></p>
    <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => {:id => "new_user_devise_form", :autocomplete => :off}) do |f| %>
      <%= devise_error_messages! %>
      <div class="form-group reg-labels">
        <%= f.hidden_field :mooc, :value => true %>
        <%= f.hidden_field :madridorgid, :value => params[:uid]  %>

        <%= f.label :email, t('mooc.sign_up_form.email')  %>
        <%= f.text_field :email, :class => "form-control small_field_email", :required => true, :autocomplete => "off" %>
        <span class="small_field_email2">@educa.madrid.org</span>

        <%= f.label :password, t('mooc.sign_up_form.password') %>
        <%= f.password_field :password, :class => "form-control", :required => true, :id => "devise_password", :autocomplete => "off" %>

        <%= f.label :password_confirmation, t('mooc.sign_up_form.confirm_password') %>
        <%= f.password_field :password_confirmation, :class => "form-control", :required => true, :autocomplete => "off" %>

        <%= f.label :name, t('mooc.sign_up_form.name') %>
        <%= f.text_field :name, :class => "form-control", :required => true, :autocomplete => "off" %>

        <%= f.label t("profile.surname"), t('mooc.sign_up_form.surname') %>
        <%= f.text_field :surname, :class => "form-control", :required => true, :autocomplete => "off" %>
        
        <%= f.label t('simple_captcha.title') %>
        <span><%= t('simple_captcha.subtitle') %></span>
        <%= show_simple_captcha %>

        <hr class="soften">
        <div class="conditions">
          <label>
            <input type="checkbox" id="inlineCheckbox1" required="required" title="You need to accept the Terms and Conditions to create your account" value="option1">
            <span class="lbl padding-0">
              <%= t('conditions.check_message') %>
              <%= link_to t('conditions.check_message_1'), '/legal_notice', :target => '_blank' %>
              <%= t('conditions.check_message_2') %>
              <%- if devise_mapping.confirmable? && controller_name != 'confirmations' %>
                <%= link_to t('confirmation.not_received.long'), new_confirmation_path(resource_name) %>.
              <% end -%>
            </span>
          </label>
          <div class="action">
            <%= f.submit t('action.accept').capitalize, :class => "btn btn-primary pull-right" %>

          </div>
        </div>
      </div>
    <% end %>

  </section>
</section>


<%= content_for :javascript do %>
    var registrationTags = [];

    //Load tags
    $.each($("#preloadTagList li"), function (index, element) {
      registrationTags.push($(element).html());
    });

    $("#registration .tagList").tagit({
      tagSource: registrationTags,
      sortable: true,
      maxLength: '<%= Vish::Application.config.tagsSettings["maxLength"] %>',
      maxTags: '<%= Vish::Application.config.tagsSettings["maxTags"] %>',
      triggerKeys: <%= raw(Vish::Application.config.tagsSettings["triggerKeys"].to_json) %>,
      watermarkAllowMessage: '<%= t('document.tags.areasOfInterestMessage') %>',
      watermarkDenyMessage: '<%= t('document.tags.limitMessage') %>',
      tagsChanged: function (tag, action) {
        //Check if the element popped is a suggestion
        if (action == "popped") {
          $.each($("#registration .tagit-suggestions li"), function (index, element) {
            if ($(element).html() == tag) {
              $(element).show();
            }
          });
        }
      }
    });

    //Allow suggestions
    $("#registration .tagit-suggestions li").on("click", function (){
      var result = $(".tagit").tagit('add', $(this).html());
      if (result == true) {
        $(this).hide();
      }
    });

    //Fill tag_list hidden input before send
    $("#registration input[type='submit']").click(function(event){
      $("#input_tag_list").val(Vish.Utils.convertToTagsArray($("#registration .tagList").tagit("tags")));
      return true;
    });

    $('#user_email').keypress(function(e){
      if(e.which == 64){
        alert("Esta edición del MOOC está cerrada a profesores de la comunidad de Madrid. No escriba el dominio del email. La plataforma añadirá @educa.madrid.org automáticamente.");
        return false;
      } else {
        return true;
      }
    });
<% end %>
