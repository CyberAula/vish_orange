<%= render :partial => 'vish_editor' %>

<script>	
	options = {};
	var configuration = {};

	configuration["mode"] = "vish";

	configuration["ImagesPath"] = "/assets/";
	configuration["StylesheetsPath"] = "/assets/";

	configuration["rootPath"] = "<%= Vish::Application.config.full_domain %>";

	configuration["Upload"] = true;
	configuration["uploadImagePath"] = "<%= documents_path :format=> "json"%>";
	configuration["uploadObjectPath"] = "<%= documents_path :format=> "json"%>";
	configuration["uploadPresentationPath"] = "<%= excursions_path :format=> "json"%>";
	configuration["uploadPDF2PPath"] = "<%= pdfexes_path :format=> "json"%>";

	// Sources enabled
	configuration["ViSH"] = true;
	configuration["ViSH_instances"] = ["<%= Vish::Application.config.full_domain %>"];
	configuration["Flickr"] = true;
	configuration["Youtube"] = true;
	configuration["Vimeo"] = false;
	configuration["LRE"] = true;
	configuration["LRE_path"] = "/lre/search";
	<%unless Vish::Application.config.APP_CONFIG['soundCloudAPIKEY'].nil? %>
		configuration["SoundCloud"] = true;
		configuration["SoundCloudAPIKEY"] =  "<%= Vish::Application.config.APP_CONFIG['soundCloudAPIKEY'] %>";
	<%end%>

	configuration["presentationSettings"] = true;

	var tagsSettings = new Object();
	  <%if !Vish::Application.config.APP_CONFIG["tagsSettings"].nil? %>
	    tagsSettings.maxLength = <%=Vish::Application.config.APP_CONFIG["tagsSettings"]["maxLength"].nil? ? "20" : Vish::Application.config.APP_CONFIG["tagsSettings"]["maxLength"]%>;
	    tagsSettings.maxTags = <%=Vish::Application.config.APP_CONFIG["tagsSettings"]["maxTags"].nil? ? "8" : Vish::Application.config.APP_CONFIG["tagsSettings"]["maxTags"] %>;
	    <%if !Vish::Application.config.APP_CONFIG["tagsSettings"]["triggerKeys"].nil?%>
	       tagsSettings.triggerKeys = <%=raw(Vish::Application.config.APP_CONFIG["tagsSettings"]["triggerKeys"].to_json)%>;
	    <%end%>
	  <%else%>
	  	tagsSettings.maxLength = 20;
		tagsSettings.maxTags = 8;
		tagsSettings.triggerKeys = ['enter', 'space', 'comma', 'tab'];       
	  <%end%>	
	
	configuration["tagsSettings"] = tagsSettings;
	
	options["configuration"] = configuration;

	options["developping"] = false;

	options["user"] = {
		name: "<%= current_subject.name %>",
		id: "<%= Actor.normalize_id(current_subject) %>",
		token: "<%= form_authenticity_token %>"
	}

	options["draft"] = true;

	options["lang"] = "<%= I18n.locale.to_s%>";

	<% if current_subject %>
		options["exitURL"]  = "<%= url_for(current_subject) %>";
	<% end %>

	<%if default_tag%>
		options["extra_tags"] = ["<%=default_tag %>"];
	<%end%>

	options.addons = [];
	var addon = new Object();
	addon.target = "Both";
	addon.id = "IframeMessenger";
	addon.config = {enable: true};
	options.addons.push(addon);

	function start(){
		VISH.Editor.init(options);
	}
</script>
