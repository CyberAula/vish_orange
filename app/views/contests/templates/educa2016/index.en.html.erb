<% content_for :banner do %>
  <%=render :partial => "contests/templates/educa2016/main_title", :locals => { :main_title_body => "" }%>
<%end%>
<div class="scrollup fa fa-arrow-up"></div>
<div class="row">
  <div class="col-md-10 col-xs-12 contest_content">

    <div class="row">
      <div class="col-md-5 text_info">
        <h2 class="primary">Summary of the EducaInternet Contest</h2>
        <br>
        <p>Students and teachers tell us their experience in the EducaInternet contest and how they managed the collaborative work with their students guided by the modules.
          Also find out how the workshop was with the winning classrooms and the rocket they created and launched into space!
        </p>
        <br>
      </div>
      <div class="col-md-1 text_info"></div>
      <div class="col-md-6 video">
        <div class="video_container">
          <iframe class="video_pres" width="640" height="480" src="https://www.youtube.com/embed/2k9zJBIr61E" frameborder="0" allowfullscreen></iframe>
        </div>

      </div>
      <div class="col-md-12 text_info">
        <h2 class="primary">Know the winners!</h2>
        <br>
        <div class="section_winners">
          <div class="section_jury col-md-6">
            <img src="../assets/contest/IMG_WEB_PREMIOS_ENG_01.jpg">
            <!-- judge's winners -->
            <div class="items win">
              <% begin
                  winers = [Link.find(293), Document.find(9229)]
                rescue ActiveRecord::RecordNotFound => e
                  winers = Document.all.sample(2)
                end %>
                <% winers.each do |doc| %>
                  <%= render partial: 'repositories/resource', locals: { resource: doc} %>
                <% end %>
                <div class="clear"></div>
            </div>
          </div>
          <div class="section_public col-md-6">
            <img src="../assets/contest/IMG_WEB_PREMIOS_ENG_02.jpg">
            <!-- public's winners -->
            <div class="items win">
              <% begin
                  winers = [Document.find(9218), Document.find(9228)]
                rescue ActiveRecord::RecordNotFound => e
                  winers = Document.all.sample(2)
                end %>
                <% winers.each do |doc| %>
                  <%= render partial: 'repositories/resource', locals: { resource: doc} %>
                <% end %>
                <div class="clear"></div>
            </div>
          </div>
        </div>

    <!-- materials -->
    <h3>Teaching materials</h3>
    <span>This materials will give you step by step guidance on how to create an entry to enter the Competition</span>
    <div class="items">
       <% begin
          categories = [Category.find(71), Category.find(100), Category.find(84),Category.find(90), Category.find(106), Category.find(114)]
        rescue ActiveRecord::RecordNotFound => e
          categories = Category.all.sample(6)
        end
        %>
      <% categories.each do |category| %>
        <%= render partial: 'contests/templates/educa2016/category', locals: { category: category} %>
      <% end %>
      <div class="clear"></div>
    </div>


    <!-- materiales castellano -->
    <h3>Materiales pedagógicos</h3>
    <span>Estos módulos te guiarán para crear un recurso con el que participar en el Concurso EducaInternet</span>
    <div class="items">

      <% begin
          categories = [Category.find(68), Category.find(97), Category.find(81), Category.find(87),Category.find(103),Category.find(111)]
      	rescue ActiveRecord::RecordNotFound => e
      	  categories = Category.all.sample(6)
      	end %>
      <% categories.each do |category| %>
        <%= render partial: 'contests/templates/educa2016/category', locals: { category: category} %>
      <% end %>
      <div class="clear"></div>
    </div>

    <!-- materiales OSI -->
    <h3>Amplía tus conocimientos</h3>
    <span>Puedes consultar estas herramientas educativas del Instituto Nacional de Ciberseguridad de España</span>
    <div class="items">

      <% begin
          categories = [Category.find(55), Category.find(56), Category.find(57), Category.find(58), Category.find(59), Category.find(60), Category.find(63), Category.find(62)]
      	rescue ActiveRecord::RecordNotFound => e
      	  categories = Category.all.sample(6)
      	end %>
      <% categories.each do |category| %>
        <%= render partial: 'contests/templates/educa2016/category', locals: { category: category} %>
      <% end %>
      <div class="clear"></div>
    </div>



  </div>

  <div class="col-md-2 col-xs-12 email_box">
    <div class="title_box">DOWNLOAD THE COMPETITION POSTER</div>

    <% showMaterials = (user_signed_in? and @contest.mail_list and @contest.mail_list.isActorSubscribed?(current_subject.actor)) %>
    <%= content_tag :div, class: "form_box", id: "educa2016materials", style: (showMaterials ? "" : "display:none") do |div| %>
      <a href="/Educa2016Poster_EN.pdf" download class="btn btn-primary width100">Download poster</a>
    <% end %>
    <% unless showMaterials %>
      <div class="form_box" style="display:none">
        <form id="educa2016materialsform" action="/contest/educa2016/educa2016materials" method="post">
          <div class="form-group">
            <input class="form-control" type="text" name="user_name" id="name" placeholder="Nombre" value="<%=user_signed_in? ? current_subject.name : ""%>">
            <input class="form-control" type="email" name="email" id="mail" placeholder="Email" value="<%=user_signed_in? ? current_subject.email : ""%>">
            <div class="actions">
              <label>
                <input id="inlineCheckbox1" required="required" name="grant" title="You need to accept to receive information" value="true" type="checkbox">
                <span id="agree_joining" class="lbl padding-0">
                  I agree to receive information about this contest
                </span>
                <span id="thanks_joining" class="lbl padding-0 thanks_txt" style="display:none">
                  Thanks, you will receive information soon
                </span>
              </label>
              <input type="submit" value="Send" class="btn btn-primary pull-right">
              <a href="/Educa2016Poster_EN.pdf" download class="btn btn-primary" style="display:none">Download poster</a>
              <div class="clear"></div>
            </div>
          </div>
        </form>
      </div>
    <% end %>
    <div class="clear"></div>
  </div>
</div>

<% content_for :javascript do %>
  $(window).scroll(function(){
   if ($(this).scrollTop() > 100) {
      $('.scrollup').fadeIn();
   } else {
      $('.scrollup').fadeOut();
   }
  });
  $('.scrollup').click(function(){
    $("html, body").animate({ scrollTop: 0 }, 600);
    return false;
  });

  $("#showingMore").click(function(e){
    if($("#showingMore").attr("status")==="expanded"){
      $("#showingMore").html('Read more about the Competition');
      $("#showingMore").attr("title", "<%=t('excursion.actions.show_fewer')%>");
      $("#showingMore").attr("status", "collapsed");
    } else {
      $("#showingMore").html('Hide info');
      $("#showingMore").attr("title", "<%=t("excursion.actions.show_more")%>");
      $("#showingMore").attr("status", "expanded");
    }
  });
  $("#educa2016materialsform").submit(function(event){
    event.preventDefault();
    var data = {};
    data["user_name"] = $("#educa2016materialsform").find("input[name='user_name']").val();
    data["email"] = $("#educa2016materialsform").find("input[name='email']").val();
    data["grant"] = $("#educa2016materialsform").find("input[name='grant']").prop("checked");
    $.ajax({
      type: "POST",
      url: $(this).attr("action"),
      data: data,
      success: function(data){
        var form = $("#educa2016materialsform")
        $(form).find("input[name='user_name']").val("").attr("readonly","readonly");
        $(form).find("input[name='email']").val("").attr("readonly","readonly");
        $(form).find("input[name='grant']").prop( "checked", false ).attr("disabled","disabled");
        $("#educa2016materialsform").find("input[type='submit']").hide();
        $("#educa2016materialsform").find("a[href='/Educa2016Poster_EN.pdf']").show();
        $("#agree_joining").hide();
        $("#thanks_joining").show();
        $("a[href='/Educa2016Poster_EN.pdf']")[0].click();
        if (window.localStorage) {
          localStorage.setItem("educa2016maillist", "subscribed");
        }
      },
      error: function(data){
        if(typeof data.responseText == "string"){
          alert(data.responseText);
        }
      },
      dataType: "json"
    });
  });

  <% unless showMaterials %>
    if ((window.localStorage)&&(localStorage.getItem("educa2016maillist")==="subscribed")){
      $("#educa2016materialsform").parent("div.form_box").hide();
      $("#educa2016materials").show();
    } else {
      $("#educa2016materialsform").parent("div.form_box").show();
      //localStorage.removeItem("educa2016maillist");
    }
  <% end %>
<%end%>
